<div class="flex min-w-0 flex-auto flex-col items-center sm:flex-row sm:justify-center md:items-start md:justify-start">
    <!-- Left side - Form -->
    <div class="w-full px-4 py-8 sm:bg-card sm:w-auto sm:rounded-2xl sm:p-12 sm:shadow md:flex md:h-full md:w-1/2 md:items-center md:justify-end md:rounded-none md:p-16 md:shadow-none">
        <div class="mx-auto w-full max-w-80 sm:mx-0 sm:w-80">
            <!-- Logo -->
            <div class="mb-6 flex justify-center">
                <div class="inline-block rounded-3xl bg-fidelity-primary/10 p-3 ring-2 ring-fidelity-primary/20">
                    <img src="https://pbs.twimg.com/profile_images/1767198674373734400/R9lqG20r_400x400.jpg" 
                         alt="Fidelity Insurance Logo" 
                         class="h-16 w-16 rounded-2xl object-cover ring-2 ring-fidelity-primary shadow-lg"/>
                </div>
            </div>

            <!-- Title -->
            <div class="text-center mb-8">
                <div class="text-3xl font-extrabold leading-tight tracking-tight text-fidelity-primary mb-2">
                    Change Your Password
                </div>
                <div class="text-gray-600 font-medium">
                    Update your password to keep your account secure
                </div>
            </div>

            <!-- Alert -->
            @if (showAlert) {
                <fuse-alert
                    class="mt-6 mb-6"
                    [appearance]="'outline'"
                    [showIcon]="true"
                    [type]="alert.type"
                    [@shake]="alert.type === 'error'"
                >
                    {{ alert.message }}
                </fuse-alert>
            }

            <!-- Change password form -->
            <form
                class="space-y-6"
                [formGroup]="changePasswordForm"
                #changePasswordNgForm="ngForm"
            >
                <!-- Current Password field -->
                <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-700">Current Password</label>
                    <div class="relative">
                        <input
                            id="currentPassword"
                            matInput
                            [type]="showCurrentPassword ? 'text' : 'password'"
                            class="w-full rounded-xl border-2 border-gray-200 px-4 py-3 text-sm transition-all duration-200 focus:border-fidelity-primary focus:ring-4 focus:ring-fidelity-primary/20 focus:outline-none"
                            [formControlName]="'currentPassword'"
                            placeholder="Enter your current password"
                        />
                        <button
                            type="button"
                            class="absolute inset-y-0 right-0 flex items-center pr-4 text-gray-400 hover:text-fidelity-primary transition-colors"
                            (click)="toggleCurrentPasswordVisibility()"
                        >
                            <mat-icon class="icon-size-5">
                                {{ showCurrentPassword ? 'visibility_off' : 'visibility' }}
                            </mat-icon>
                        </button>
                    </div>
                    @if (changePasswordForm.get('currentPassword')?.invalid && changePasswordForm.get('currentPassword')?.touched) {
                        <div class="text-red-500 text-sm font-medium">Current password is required</div>
                    }
                </div>

                <!-- New Password field -->
                <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-700">New Password</label>
                    <div class="relative">
                        <input
                            id="newPassword"
                            matInput
                            [type]="showNewPassword ? 'text' : 'password'"
                            class="w-full rounded-xl border-2 border-gray-200 px-4 py-3 text-sm transition-all duration-200 focus:border-fidelity-primary focus:ring-4 focus:ring-fidelity-primary/20 focus:outline-none"
                            [formControlName]="'newPassword'"
                            placeholder="Enter your new password"
                        />
                        <button
                            type="button"
                            class="absolute inset-y-0 right-0 flex items-center pr-4 text-gray-400 hover:text-fidelity-primary transition-colors"
                            (click)="toggleNewPasswordVisibility()"
                        >
                            <mat-icon class="icon-size-5">
                                {{ showNewPassword ? 'visibility_off' : 'visibility' }}
                            </mat-icon>
                        </button>
                    </div>
                    
                    <!-- Password strength indicator -->
                    @if (changePasswordForm.get('newPassword')?.value && changePasswordForm.get('newPassword')?.touched) {
                        <div class="mt-3 space-y-2">
                            <div class="text-xs font-medium text-gray-600 mb-2">Password Requirements:</div>
                            <div class="grid grid-cols-1 gap-1">
                                <div class="flex items-center text-xs" [class.text-green-600]="hasMinLength(changePasswordForm.get('newPassword')?.value)" [class.text-gray-400]="!hasMinLength(changePasswordForm.get('newPassword')?.value)">
                                    <mat-icon class="text-xs mr-2">{{ hasMinLength(changePasswordForm.get('newPassword')?.value) ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                                    At least 8 characters
                                </div>
                                <div class="flex items-center text-xs" [class.text-green-600]="hasLowercase(changePasswordForm.get('newPassword')?.value)" [class.text-gray-400]="!hasLowercase(changePasswordForm.get('newPassword')?.value)">
                                    <mat-icon class="text-xs mr-2">{{ hasLowercase(changePasswordForm.get('newPassword')?.value) ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                                    One lowercase letter
                                </div>
                                <div class="flex items-center text-xs" [class.text-green-600]="hasUppercase(changePasswordForm.get('newPassword')?.value)" [class.text-gray-400]="!hasUppercase(changePasswordForm.get('newPassword')?.value)">
                                    <mat-icon class="text-xs mr-2">{{ hasUppercase(changePasswordForm.get('newPassword')?.value) ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                                    One uppercase letter
                                </div>
                                <div class="flex items-center text-xs" [class.text-green-600]="hasNumber(changePasswordForm.get('newPassword')?.value)" [class.text-gray-400]="!hasNumber(changePasswordForm.get('newPassword')?.value)">
                                    <mat-icon class="text-xs mr-2">{{ hasNumber(changePasswordForm.get('newPassword')?.value) ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                                    One number
                                </div>
                                <div class="flex items-center text-xs" [class.text-green-600]="hasSpecialChar(changePasswordForm.get('newPassword')?.value)" [class.text-gray-400]="!hasSpecialChar(changePasswordForm.get('newPassword')?.value)">
                                    <mat-icon class="text-xs mr-2">{{ hasSpecialChar(changePasswordForm.get('newPassword')?.value) ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                                    One special character
                                </div>
                            </div>
                        </div>
                    }
                    
                    @if (changePasswordForm.get('newPassword')?.invalid && changePasswordForm.get('newPassword')?.touched) {
                        <div class="text-red-500 text-sm font-medium">Please enter a valid password</div>
                    }
                </div>

                <!-- Confirm New Password field -->
                <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-700">Confirm New Password</label>
                    <div class="relative">
                        <input
                            id="confirmPassword"
                            matInput
                            [type]="showConfirmPassword ? 'text' : 'password'"
                            class="w-full rounded-xl border-2 border-gray-200 px-4 py-3 text-sm transition-all duration-200 focus:border-fidelity-primary focus:ring-4 focus:ring-fidelity-primary/20 focus:outline-none"
                            [formControlName]="'confirmPassword'"
                            placeholder="Confirm your new password"
                        />
                        <button
                            type="button"
                            class="absolute inset-y-0 right-0 flex items-center pr-4 text-gray-400 hover:text-fidelity-primary transition-colors"
                            (click)="toggleConfirmPasswordVisibility()"
                        >
                            <mat-icon class="icon-size-5">
                                {{ showConfirmPassword ? 'visibility_off' : 'visibility' }}
                            </mat-icon>
                        </button>
                    </div>
                    @if (changePasswordForm.get('confirmPassword')?.invalid && changePasswordForm.get('confirmPassword')?.touched) {
                        <div class="text-red-500 text-sm font-medium">
                            @if (changePasswordForm.get('confirmPassword')?.hasError('required')) {
                                Password confirmation is required
                            }
                            @if (changePasswordForm.get('confirmPassword')?.hasError('mustMatch')) {
                                Passwords must match
                            }
                        </div>
                    }
                </div>

                <!-- Submit button -->
                <button
                    type="button"
                    class="w-full rounded-xl py-4 text-sm font-bold transition-all duration-300 transform hover:scale-[1.02] focus:outline-none focus:ring-4 focus:ring-fidelity-primary/30 shadow-lg"
                    [class.bg-fidelity-primary]="changePasswordForm.valid && !changePasswordForm.disabled"
                    [class.text-white]="changePasswordForm.valid && !changePasswordForm.disabled"
                    [class.hover:bg-fidelity-secondary]="changePasswordForm.valid && !changePasswordForm.disabled"
                    [class.hover:text-fidelity-primary]="changePasswordForm.valid && !changePasswordForm.disabled"
                    [class.bg-gray-200]="changePasswordForm.invalid || changePasswordForm.disabled"
                    [class.text-gray-500]="changePasswordForm.invalid || changePasswordForm.disabled"
                    [class.cursor-not-allowed]="changePasswordForm.invalid || changePasswordForm.disabled"
                    [disabled]="changePasswordForm.invalid || changePasswordForm.disabled"
                    (click)="changePassword()"
                >
                    @if (!changePasswordForm.disabled) {
                        <span class="flex items-center justify-center">
                            <mat-icon class="mr-2">security</mat-icon>
                            Update Password
                        </span>
                    }
                    @if (changePasswordForm.disabled) {
                        <div class="flex items-center justify-center">
                            <mat-progress-spinner
                                [diameter]="20"
                                [mode]="'indeterminate'"
                                class="mr-2"
                            ></mat-progress-spinner>
                            <span>Updating Password...</span>
                        </div>
                    }
                </button>

                <!-- Form footer -->
                <div class="text-center pt-4">
                    <div class="text-sm text-gray-500 mb-4">
                        <span>Need help? Contact our</span>
                        <a class="ml-1 text-fidelity-primary hover:underline font-medium" href="mailto:support@fidelity.co.ke">
                            support team
                        </a>
                    </div>
                    <div class="text-sm font-medium">
                        <a
                            class="text-fidelity-primary hover:text-fidelity-secondary transition-colors duration-200 flex items-center justify-center"
                            [routerLink]="['/dashboard']"
                        >
                            <mat-icon class="mr-1 text-sm">arrow_back</mat-icon>
                            Back to Dashboard
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Right side - Branding -->
    <div class="relative hidden h-full w-1/2 flex-auto items-center justify-center overflow-hidden p-16 md:flex lg:px-28" 
         style="background: linear-gradient(135deg, #007B7B 0%, #005555 100%);">
        
        <!-- Background decorative elements -->
        <div class="absolute inset-0 overflow-hidden">
            <!-- Floating geometric shapes -->
            <div class="absolute top-20 left-20 w-32 h-32 rounded-full opacity-20" style="background: #B7DC78;"></div>
            <div class="absolute bottom-32 right-16 w-24 h-24 rounded-full opacity-15" style="background: #B7DC78;"></div>
            <div class="absolute top-1/2 left-10 w-16 h-16 rotate-45 opacity-10" style="background: #B7DC78;"></div>
            
            <!-- Grid pattern -->
            <svg class="absolute inset-0 w-full h-full opacity-5" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                        <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#B7DC78" stroke-width="1"/>
                    </pattern>
                </defs>
                <rect width="100%" height="100%" fill="url(#grid)" />
            </svg>
        </div>

        <!-- Content -->
        <div class="relative z-10 w-full max-w-2xl text-center">
            <div class="mb-8">
                <div class="inline-block rounded-full bg-white/10 p-6 backdrop-blur-sm">
                    <mat-icon class="text-6xl text-white">shield</mat-icon>
                </div>
            </div>
            
            <div class="text-5xl font-bold leading-tight text-white mb-6">
                <div class="bg-gradient-to-r from-white to-green-100 bg-clip-text text-transparent">
                    Secure Your Account
                </div>
            </div>
            
            <div class="text-xl leading-relaxed text-white/90 mb-8">
                Keep your Fidelity Insurance account protected with a strong, unique password. 
                Your security is our priority.
            </div>

            <!-- Security features -->
            <div class="grid grid-cols-1 gap-4 text-left">
                <div class="flex items-center p-4 rounded-xl bg-white/10 backdrop-blur-sm">
                    <div class="flex-shrink-0 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center mr-4">
                        <mat-icon class="text-white">encrypted</mat-icon>
                    </div>
                    <div>
                        <div class="text-white font-semibold">End-to-End Encryption</div>
                        <div class="text-white/70 text-sm">Your password is encrypted and secure</div>
                    </div>
                </div>
                
                <div class="flex items-center p-4 rounded-xl bg-white/10 backdrop-blur-sm">
                    <div class="flex-shrink-0 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center mr-4">
                        <mat-icon class="text-white">verified_user</mat-icon>
                    </div>
                    <div>
                        <div class="text-white font-semibold">Multi-Factor Authentication</div>
                        <div class="text-white/70 text-sm">Additional security layers protect your account</div>
                    </div>
                </div>
                
                <div class="flex items-center p-4 rounded-xl bg-white/10 backdrop-blur-sm">
                    <div class="flex-shrink-0 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center mr-4">
                        <mat-icon class="text-white">history</mat-icon>
                    </div>
                    <div>
                        <div class="text-white font-semibold">Activity Monitoring</div>
                        <div class="text-white/70 text-sm">We monitor for suspicious activities</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
