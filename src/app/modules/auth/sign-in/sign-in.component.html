<!-- Terms of Service Modal -->
<div *ngIf="showTermsModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-2 sm:p-4" (click)="showTermsModal = false">
    <div class="max-h-[95vh] w-full max-w-4xl overflow-y-auto rounded-lg bg-white shadow-xl" (click)="$event.stopPropagation()">
        <div class="sticky top-0 bg-white border-b border-gray-200 px-3 py-3 sm:px-6 sm:py-4">
            <div class="flex items-center justify-between">
                <h2 class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-800">Terms of Service</h2>
                <button (click)="showTermsModal = false" class="text-gray-400 hover:text-gray-600 p-1">
                    <mat-icon class="text-lg sm:text-xl">close</mat-icon>
                </button>
            </div>
        </div>
        <div class="px-3 py-4 sm:px-6 sm:py-6">
            <div class="prose max-w-none text-sm sm:text-base md:text-lg text-gray-700">
                <p class="mb-3 sm:mb-4"><strong>Terms of Use for Fidelity Insurance Company Limited</strong></p>
                <p class="mb-3 sm:mb-4">By accessing and using the services provided by Fidelity Insurance Company Limited, you agree to comply with and be bound by the following terms and conditions:</p>
                <div class="space-y-3 sm:space-y-4">
                    <div><h3 class="font-semibold text-sm sm:text-base">1. Service Agreement</h3><p class="text-sm sm:text-base mt-1">These terms constitute a binding agreement between you and Fidelity Insurance Company Limited regarding your use of our insurance services and platform.</p></div>
                    <div><h3 class="font-semibold text-sm sm:text-base">2. Eligibility</h3><p class="text-sm sm:text-base mt-1">You must be at least 18 years old and legally capable of entering into binding contracts to use our services.</p></div>
                    <div><h3 class="font-semibold text-sm sm:text-base">3. Accurate Information</h3><p class="text-sm sm:text-base mt-1">You agree to provide accurate, current, and complete information during registration and throughout your use of our services.</p></div>
                    <div><h3 class="font-semibold text-sm sm:text-base">4. Privacy and Data Protection</h3><p class="text-sm sm:text-base mt-1">Your privacy is important to us. Please review our Data Privacy Policy to understand how we collect, use, and protect your personal information.</p></div>
                    <div><h3 class="font-semibold text-sm sm:text-base">5. Service Availability</h3><p class="text-sm sm:text-base mt-1">We strive to maintain service availability but cannot guarantee uninterrupted access to our platform.</p></div>
                    <div><h3 class="font-semibold text-sm sm:text-base">6. Limitation of Liability</h3><p class="text-sm sm:text-base mt-1">Fidelity Insurance Company Limited shall not be liable for any indirect, incidental, special, consequential, or punitive damages arising from your use of our services.</p></div>
                    <div><h3 class="font-semibold text-sm sm:text-base">7. Modifications</h3><p class="text-sm sm:text-base mt-1">We reserve the right to modify these terms at any time. Continued use of our services after modifications constitutes acceptance of the updated terms.</p></div>
                </div>
                <p class="mt-4 sm:mt-6 text-xs sm:text-sm text-gray-500">Last updated: {{ getCurrentDate() }}</p>
            </div>
        </div>
        <div class="sticky bottom-0 bg-white border-t border-gray-200 px-3 py-3 sm:px-6 sm:py-4">
            <div class="flex justify-end">
                <button (click)="showTermsModal = false" class="rounded-md bg-fidelity-primary px-3 py-2 sm:px-4 text-sm sm:text-base text-white hover:bg-fidelity-secondary transition-all duration-300">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Data Privacy Policy Modal -->
<div *ngIf="showDataPrivacyModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-2 sm:p-4" (click)="showDataPrivacyModal = false">
    <div class="max-h-[95vh] w-full max-w-4xl overflow-y-auto rounded-lg bg-white shadow-xl" (click)="$event.stopPropagation()">
        <div class="sticky top-0 bg-white border-b border-gray-200 px-3 py-3 sm:px-6 sm:py-4">
            <div class="flex items-center justify-between">
                <h2 class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-800">Data Privacy Policy</h2>
                <button (click)="showDataPrivacyModal = false" class="text-gray-400 hover:text-gray-600 p-1">
                    <mat-icon class="text-lg sm:text-xl">close</mat-icon>
                </button>
            </div>
        </div>
        <div class="px-3 py-4 sm:px-6 sm:py-6">
            <div class="prose max-w-none text-sm sm:text-base md:text-lg text-gray-700">
                <p class="mb-3 sm:mb-4"><strong>Data Privacy Statement - Fidelity Insurance Company Limited</strong></p>
                <p class="mb-3 sm:mb-4">Fidelity Insurance Company Limited is committed to protecting the fundamental human right to privacy of those with whom we interact. We recognize the need to safeguard personal data that is collected or disclosed to us as part of the Know-your-customer information required by us in order to provide you with the requisite financial product or service.</p>
                <p class="mb-3 sm:mb-4">We are committed to complying with the requirements of the Data Protection Act and the attendant regulations as well as best global best practices regarding the processing of your personal data. In this regard, you are required to acquaint yourselves with our data privacy statement which is intended to tell you how we use your personal data and describes how we collect and process your personal data during and after your relationship with us.</p>
                <div class="space-y-3 sm:space-y-4">
                    <div><h3 class="font-semibold text-sm sm:text-base">Data Collection</h3><p class="text-sm sm:text-base mt-1">We collect personal data necessary for providing insurance services, including but not limited to identification information, contact details, and financial information required for Know Your Customer (KYC) compliance.</p></div>
                    <div><h3 class="font-semibold text-sm sm:text-base">Purpose of Processing</h3><p class="text-sm sm:text-base mt-1">Your personal data is processed for the following purposes:</p><ul class="ml-3 sm:ml-4 list-disc space-y-1 mt-2 text-sm sm:text-base"><li>Provision of insurance products and services</li><li>Compliance with regulatory requirements</li><li>Risk assessment and underwriting</li><li>Claims processing and settlement</li><li>Customer service and support</li></ul></div>
                    <div><h3 class="font-semibold text-sm sm:text-base">Data Security</h3><p class="text-sm sm:text-base mt-1">We implement appropriate technical and organizational measures to protect your personal data against unauthorized access, alteration, disclosure, or destruction.</p></div>
                    <div><h3 class="font-semibold text-sm sm:text-base">Your Rights</h3><p class="text-sm sm:text-base mt-1">You have the right to access, rectify, erase, or restrict processing of your personal data, as well as the right to data portability and to object to processing under certain circumstances.</p></div>
                    <div><h3 class="font-semibold text-sm sm:text-base">Data Retention</h3><p class="text-sm sm:text-base mt-1">We retain your personal data only for as long as necessary to fulfill the purposes for which it was collected or as required by applicable laws and regulations.</p></div>
                    <div><h3 class="font-semibold text-sm sm:text-base">Contact Information</h3><p class="text-sm sm:text-base mt-1">For more detailed information about our data processing practices, please visit: <a href="https://fidelity.co.ke/data-privacy-statement/" target="_blank" class="text-fidelity-primary hover:underline break-all">https://fidelity.co.ke/data-privacy-statement/</a></p></div>
                </div>
                <p class="mt-4 sm:mt-6 text-xs sm:text-sm text-gray-500">Last updated: {{ getCurrentDate() }}</p>
            </div>
        </div>
        <div class="sticky bottom-0 bg-white border-t border-gray-200 px-3 py-3 sm:px-6 sm:py-4">
            <div class="flex justify-end">
                <button (click)="showDataPrivacyModal = false" class="rounded-md bg-fidelity-primary px-3 py-2 sm:px-4 text-sm sm:text-base text-white hover:bg-fidelity-secondary transition-all duration-300">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Main Container - Now uses min-height to allow scrolling on small screens -->
<div class="relative flex min-h-screen w-full flex-col">
    <!-- Bottom Right Toast Alert -->
    <div class="fixed bottom-2 right-2 sm:bottom-4 sm:right-4 z-50 max-w-[90vw] sm:max-w-none" *ngIf="showAlert">
        <fuse-alert class="login-toast show text-sm sm:text-base" [appearance]="'fill'" [showIcon]="true" [type]="alert.type">
            {{ alert.message }}
        </fuse-alert>
    </div>

    <!-- Layout container: flex-col-reverse for mobile, lg:flex-row for desktop -->
    <div class="flex min-w-0 flex-auto flex-col-reverse lg:flex-row">
        <!-- Fidelity Get Quote Portal (Teal Section) -->
        <div class="relative flex lg:h-screen w-full lg:w-1/2 flex-auto justify-center p-4 sm:p-6 md:p-8 lg:p-12 xl:px-20" style="background-color: #007B7B">
            <div class="absolute inset-0 overflow-hidden">
                <!-- Floating pear-shaped element in Pantone 366 C -->
                <div class="absolute w-32 h-40 sm:w-40 sm:h-48 floating-blob" style="background-color: #B7DC78; border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; transform: rotate(-15deg);"></div>
            </div>
            <div class="relative z-10 w-full max-w-2xl flex flex-col justify-center">
                <div class="mb-3 sm:mb-4 flex justify-center">
                    <div class="inline-block rounded-3xl bg-fidelity-primary/10 p-3 ring-2 ring-fidelity-primary/20">
                        <img src="https://pbs.twimg.com/profile_images/1767198674373734400/R9lqG20r_400x400.jpg" alt="Fidelity Insurance Logo" class="h-12 w-12 sm:h-16 sm:w-16 rounded-2xl object-cover ring-2 ring-fidelity-primary shadow-lg"/>
                    </div>
                </div>
                <div class="mb-1 sm:mb-2 text-center text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold leading-tight text-white">
                    <div class="bg-gradient-to-r from-white to-green-100 bg-clip-text text-transparent">Insurance you can trust.</div>
                </div>
                <div class="mt-2 sm:mt-3 max-w-lg mx-auto text-center text-sm sm:text-base md:text-lg leading-relaxed text-white/90">Get a quick quote — no login required.</div>
                <div class="mt-4 sm:mt-6 space-y-3 sm:space-y-4">
                    <div class="group rounded-2xl border border-white/20 bg-white/10 p-3 sm:p-4 backdrop-blur-sm transition-all duration-300 hover:bg-white/15">
                        <div class="flex flex-col items-start justify-between gap-2 sm:gap-3 md:flex-row md:items-center md:gap-0">
                            <div>
                                <h3 class="text-base sm:text-lg font-semibold text-white">Golfers Insurance</h3>
                                <p class="text-xs sm:text-sm text-white/70">Cover for your equipment & liability.</p>
                            </div>
                            <a href="/sign-up/golfers-quote" class="w-full cursor-pointer rounded-xl bg-fidelity-secondary text-fidelity-primary px-3 py-1.5 sm:px-4 sm:py-2 text-center text-xs sm:text-sm font-medium shadow-lg transition-all duration-200 hover:bg-opacity-80 md:w-auto">Get Quote</a>
                        </div>
                    </div>
                    <div class="group rounded-2xl border border-white/20 bg-white/10 p-3 sm:p-4 backdrop-blur-sm transition-all duration-300 hover:bg-white/15">
                        <div class="flex flex-col items-start justify-between gap-2 sm:gap-3 md:flex-row md:items-center md:gap-0">
                            <div>
                                <h3 class="text-base sm:text-lg font-semibold text-white">Marine Insurance</h3>
                                <p class="text-xs sm:text-sm text-white/70">Protect your vessels & cargo</p>
                            </div>
                            <a href="/sign-up/marine-quote" class="w-full cursor-pointer rounded-xl bg-fidelity-secondary text-fidelity-primary px-3 py-1.5 sm:px-4 sm:py-2 text-center text-xs sm:text-sm font-medium shadow-lg transition-all duration-200 hover:bg-opacity-80 md:w-auto">Get Quote</a>
                        </div>
                    </div>
                    <div class="group rounded-2xl border border-white/20 bg-white/10 p-3 sm:p-4 backdrop-blur-sm transition-all duration-300 hover:bg-white/15">
                        <div class="flex flex-col items-start justify-between gap-2 sm:gap-3 md:flex-row md:items-center md:gap-0">
                            <div>
                                <h3 class="text-base sm:text-lg font-semibold text-white">Travel Insurance</h3>
                                <p class="text-xs sm:text-sm text-white/70">Comprehensive travel coverage.</p>
                            </div>
                            <a href="/sign-up/travel-quote" class="w-full cursor-pointer rounded-xl bg-fidelity-secondary text-fidelity-primary px-3 py-1.5 sm:px-4 sm:py-2 text-center text-xs sm:text-sm font-medium shadow-lg transition-all duration-200 hover:bg-opacity-80 md:w-auto">Get Quote</a>
                        </div>
                    </div>
                    <div class="group rounded-2xl border border-white/20 bg-white/10 p-3 sm:p-4 backdrop-blur-sm transition-all duration-300 hover:bg-white/15">
                        <div class="flex flex-col items-start justify-between gap-2 sm:gap-3 md:flex-row md:items-center md:gap-0">
                            <div>
                                <h3 class="text-base sm:text-lg font-semibold text-white">Personal Accident</h3>
                                <p class="text-xs sm:text-sm text-white/70">Protection against accidental injuries.</p>
                            </div>
                            <a href="/sign-up/personal-accident-quote" class="w-full cursor-pointer rounded-xl bg-fidelity-secondary text-fidelity-primary px-3 py-1.5 sm:px-4 sm:py-2 text-center text-xs sm:text-sm font-medium shadow-lg transition-all duration-200 hover:bg-opacity-80 md:w-auto">Get Quote</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login/Register Form (White Section) -->
        <div class="relative flex lg:h-screen w-full lg:w-1/2 flex-auto flex-col items-center justify-center bg-white p-3 sm:p-4 md:p-6 lg:p-8">
            <div class="w-full max-w-md">
                <!-- Login Form -->
                <div *ngIf="formType === 'login'" class="animate-fade-in">
                    <div class="mb-4 sm:mb-6 text-center">
                        <div class="mb-3 flex justify-center">
                            <div class="inline-block rounded-2xl bg-fidelity-primary/10 p-2 ring-2 ring-fidelity-primary/20">
                                <img src="https://pbs.twimg.com/profile_images/1767198674373734400/R9lqG20r_400x400.jpg" alt="Fidelity Insurance Logo" class="h-12 w-12 rounded-xl object-cover ring-2 ring-fidelity-primary shadow-lg"/>
                            </div>
                        </div>
                        <div class="text-xl sm:text-2xl font-bold text-fidelity-primary">Welcome Back</div>
                        <div class="mt-1 text-xs sm:text-sm text-gray-500">Sign in to the Fidelity Insurance Platform</div>
                    </div>
                    <form [formGroup]="signInForm">
                        <div *ngIf="loginState === 'credentials'">
                            <div class="mb-2 sm:mb-3">
                                <label class="mb-1 block text-xs sm:text-sm font-medium text-gray-700">Email Address</label>
                                <input type="email" class="w-full rounded-md border border-gray-300 px-3 py-1.5 sm:py-2 text-xs sm:text-sm shadow-sm focus:border-fidelity-primary focus:ring-fidelity-primary" formControlName="username" placeholder="your-email@example.com"/>
                            </div>
                            <div class="mb-2 sm:mb-3">
                                <label class="mb-1 block text-xs sm:text-sm font-medium text-gray-700">Password</label>
                                <div class="relative">
                                    <input [type]="showPassword ? 'text' : 'password'" class="w-full rounded-md border border-gray-300 px-3 py-1.5 sm:py-2 text-xs sm:text-sm shadow-sm focus:border-fidelity-primary focus:ring-fidelity-primary" formControlName="password" placeholder="Password"/>
                                    <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600" (click)="togglePasswordVisibility()">
                                        <mat-icon class="text-sm">{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                                    </button>
                                </div>
                            </div>
                            <div class="mb-2 sm:mb-3 flex items-start">
                                <mat-checkbox formControlName="agreementAccepted" id="signin-agreement" class="flex-shrink-0 mt-0.5 scale-75 sm:scale-100"></mat-checkbox>
                                <label for="signin-agreement" class="ml-1 sm:ml-2 text-xs text-gray-600 leading-relaxed">I agree to the <a href="#" class="font-medium text-fidelity-primary hover:underline" (click)="showTermsModal = true; $event.preventDefault()">Terms of Service</a> and <a href="#" class="font-medium text-fidelity-primary hover:underline" (click)="showDataPrivacyModal = true; $event.preventDefault()">Data Privacy Policy</a>.</label>
                            </div>
                        </div>
                        <div *ngIf="loginState === 'otp'">
                             <div class="mb-2 sm:mb-3">
                                 <label class="mb-1 block text-xs sm:text-sm font-medium text-gray-700">Enter OTP Code</label>
                                 <input type="text" class="w-full rounded-md border border-gray-300 px-3 py-1.5 sm:py-2 text-center text-base sm:text-lg tracking-[.3em] shadow-sm focus:border-fidelity-primary focus:ring-fidelity-primary" formControlName="otp" placeholder="_ _ _ _ _ _ _ _" maxlength="8"/>
                                 <div class="mt-2 flex items-center justify-between text-xs">
                                     <a (click)="backToCredentials()" class="cursor-pointer font-medium text-fidelity-primary hover:underline">Back to login</a>
                                     <a (click)="submitCredentials()" [class.pointer-events-none]="signInForm.disabled" [class.text-gray-400]="signInForm.disabled" class="cursor-pointer font-medium text-fidelity-primary hover:underline">
                                         <ng-container *ngIf="signInForm.disabled; else notSending"><span>Sending...</span></ng-container>
                                         <ng-template #notSending><span>Resend OTP</span></ng-template>
                                     </a>
                                 </div>
                             </div>
                             <div class="mb-2 sm:mb-3 flex items-start">
                                <mat-checkbox formControlName="agreementAccepted" id="otp-agreement" class="flex-shrink-0 mt-0.5 scale-75 sm:scale-100"></mat-checkbox>
                                <label for="otp-agreement" class="ml-1 sm:ml-2 text-xs text-gray-600 leading-relaxed">I agree to the <a href="#" class="font-medium text-fidelity-primary hover:underline" (click)="showTermsModal = true; $event.preventDefault()">Terms of Service</a> and <a href="#" class="font-medium text-fidelity-primary hover:underline" (click)="showDataPrivacyModal = true; $event.preventDefault()">Data Privacy Policy</a>.</label>
                            </div>
                        </div>
                        <button type="button" (click)="handleSignIn()" class="mt-3 sm:mt-4 w-full rounded-md py-2 text-xs sm:text-sm font-semibold transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2" [ngClass]="{ 'bg-fidelity-primary text-white hover:bg-fidelity-secondary focus:ring-fidelity-primary': signInForm.valid, 'cursor-not-allowed bg-gray-200 text-gray-500': signInForm.invalid || signInForm.disabled }" [disabled]="signInForm.invalid || signInForm.disabled">
                            <ng-container *ngIf="!signInForm.disabled; else signingIn">
                                <span *ngIf="loginState === 'credentials'">Sign In</span>
                                <span *ngIf="loginState === 'otp'">Verify Code</span>
                            </ng-container>
                            <ng-template #signingIn>
                                <div class="flex items-center justify-center">
                                    <mat-progress-spinner [diameter]="16" mode="indeterminate" class="mr-2"></mat-progress-spinner>
                                    <span *ngIf="loginState === 'credentials'">Signing in...</span>
                                    <span *ngIf="loginState === 'otp'">Verifying...</span>
                                </div>
                            </ng-template>
                        </button>
                    </form>
                    <div class="mt-3 sm:mt-4 flex flex-col sm:flex-row items-center justify-between gap-2 sm:gap-0 text-xs">
                        <a class="font-medium text-fidelity-primary hover:underline" routerLink="/forgot-password">Forgot password?</a>
                        <div class="text-center sm:text-right">
                            <span class="text-gray-600">No account?</span>
                            <a class="ml-1 cursor-pointer font-medium text-fidelity-primary hover:underline" (click)="formType = 'register'">Register here</a>
                        </div>
                    </div>
                </div>

                <!-- Registration Form -->
                <div *ngIf="formType === 'register'" class="animate-fade-in">
                    <div class="mb-2 sm:mb-3 text-center">
                        <div class="text-lg sm:text-xl font-bold text-gray-800">Create Your Account</div>
                        <div class="mt-1 text-xs sm:text-sm text-gray-500">Fill in the details below to get started</div>
                    </div>
                    <form [formGroup]="registerForm" novalidate>
                        <div class="mb-2">
                            <label class="mb-1 block text-xs font-medium text-gray-700">Account Type</label>
                            <mat-radio-group class="flex flex-col sm:flex-row gap-1 sm:gap-2" formControlName="accountType">
                                <mat-radio-button value="C" class="text-xs">Individual</mat-radio-button>
                                <mat-radio-button value="A" class="text-xs">Intermediary</mat-radio-button>
                            </mat-radio-group>
                        </div>
                        <div *ngIf="registerForm.get('accountType').value === 'C'">
                            <div class="grid grid-cols-1 gap-x-2 sm:gap-x-3 sm:grid-cols-2">
                                <div class="mb-2">
                                    <label class="mb-1 block text-xs font-medium text-gray-700">Full Name</label>
                                    <input type="text" class="w-full rounded-md border px-2 py-1.5 text-xs shadow-sm focus:border-fidelity-primary focus:ring-fidelity-primary" [class.border-red-300]="registerForm.get('fullName')?.invalid && registerForm.get('fullName')?.touched" formControlName="fullName" placeholder="First Name Last Name"/>
                                    <div *ngIf="registerForm.get('fullName')?.invalid && registerForm.get('fullName')?.touched" class="mt-0.5 text-xs text-red-500">
                                        <span *ngIf="registerForm.get('fullName')?.errors?.['required']">Full name is required</span>
                                        <span *ngIf="registerForm.get('fullName')?.errors?.['fullNameInvalid']">Enter at least two names</span>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="mb-1 block text-xs font-medium text-gray-700">Email Address</label>
                                    <input type="email" class="w-full rounded-md border px-2 py-1.5 text-xs shadow-sm focus:border-fidelity-primary focus:ring-fidelity-primary" [class.border-red-300]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched" formControlName="email" placeholder="your-email@example.com"/>
                                    <div *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched" class="mt-0.5 text-xs text-red-500">
                                        <span *ngIf="registerForm.get('email')?.errors?.['required']">Email is required</span>
                                        <span *ngIf="registerForm.get('email')?.errors?.['email']">Enter a valid email</span>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="mb-1 block text-xs font-medium text-gray-700">KRA PIN</label>
                                    <input type="text" class="w-full rounded-md border px-2 py-1.5 text-xs shadow-sm focus:border-fidelity-primary focus:ring-fidelity-primary" [class.border-red-300]="registerForm.get('kraPin')?.invalid && registerForm.get('kraPin')?.touched" formControlName="kraPin" placeholder="A123456789M" (input)="onKraPinChange($event)" maxlength="11"/>
                                    <div *ngIf="registerForm.get('kraPin')?.invalid && registerForm.get('kraPin')?.touched" class="mt-0.5 text-xs text-red-500">
                                        <span *ngIf="registerForm.get('kraPin')?.errors?.['required']">KRA PIN is required</span>
                                        <span *ngIf="registerForm.get('kraPin')?.errors?.['kraPinInvalid']">Format: A123456789M</span>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="mb-1 block text-xs font-medium text-gray-700">Phone Number</label>
                                    <input type="tel" class="w-full rounded-md border px-2 py-1.5 text-xs shadow-sm focus:border-fidelity-primary focus:ring-fidelity-primary" [class.border-red-300]="registerForm.get('phoneNumber')?.invalid && registerForm.get('phoneNumber')?.touched" formControlName="phoneNumber" placeholder="+254712345678" (input)="onPhoneNumberChange($event)" maxlength="13"/>
                                    <div *ngIf="registerForm.get('phoneNumber')?.invalid && registerForm.get('phoneNumber')?.touched" class="mt-0.5 text-xs text-red-500">
                                        <span *ngIf="registerForm.get('phoneNumber')?.errors?.['required']">Phone is required</span>
                                        <span *ngIf="registerForm.get('phoneNumber')?.errors?.['phoneNumberInvalid']">Use +254 format</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div *ngIf="registerForm.get('accountType').value === 'A'">
                           <div class="grid grid-cols-1 gap-x-2 sm:gap-x-3 sm:grid-cols-2">
                                <div class="mb-2">
                                    <label class="mb-1 block text-xs font-medium text-gray-700">Intermediary - IRA Number</label>
                                    <input type="text" class="w-full rounded-md border px-2 py-1.5 text-xs shadow-sm focus:border-fidelity-primary focus:ring-fidelity-primary" formControlName="iraNumber" placeholder="IRA Number"/>
                                </div>
                                <div class="mb-2">
                                    <label class="mb-1 block text-xs font-medium text-gray-700">PIN Number</label>
                                    <input type="text" class="w-full rounded-md border px-2 py-1.5 text-xs shadow-sm focus:border-fidelity-primary focus:ring-fidelity-primary" formControlName="pinNumber" placeholder="PIN Number"/>
                                </div>
                           </div>
                        </div>
                        <div class="mb-2">
                            <label class="mb-1 block text-xs font-medium text-gray-700">Password</label>
                            <div class="relative">
                                <input [type]="showPassword ? 'text' : 'password'" class="w-full rounded-md border px-2 py-1.5 pr-6 text-xs shadow-sm focus:border-fidelity-primary focus:ring-fidelity-primary" [class.border-red-300]="password?.invalid && password?.touched" formControlName="password" placeholder="Create a strong password" required/>
                                <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-2 text-gray-400 hover:text-gray-600" (click)="togglePasswordVisibility()">
                                    <mat-icon class="text-xs">{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                                </button>
                            </div>
                            <div *ngIf="password?.touched && password?.value" class="mt-1">
                                <ul class="space-y-0.5 text-xs text-gray-500">
                                    <li class="flex items-center" [class.text-green-600]="hasMinLength(password.value)">
                                        <mat-icon class="text-xs mr-1">{{ hasMinLength(password.value) ? 'check_circle' : 'cancel' }}</mat-icon>
                                        <span class="text-xs">At least 8 characters</span>
                                    </li>
                                    <li class="flex items-center" [class.text-green-600]="hasLowercase(password.value)">
                                        <mat-icon class="text-xs mr-1">{{ hasLowercase(password.value) ? 'check_circle' : 'cancel' }}</mat-icon>
                                        <span class="text-xs">One lowercase letter</span>
                                    </li>
                                    <li class="flex items-center" [class.text-green-600]="hasUppercase(password.value)">
                                        <mat-icon class="text-xs mr-1">{{ hasUppercase(password.value) ? 'check_circle' : 'cancel' }}</mat-icon>
                                        <span class="text-xs">One uppercase letter</span>
                                    </li>
                                    <li class="flex items-center" [class.text-green-600]="hasNumber(password.value)">
                                        <mat-icon class="text-xs mr-1">{{ hasNumber(password.value) ? 'check_circle' : 'cancel' }}</mat-icon>
                                        <span class="text-xs">One number</span>
                                    </li>
                                    <li class="flex items-center" [class.text-green-600]="hasSpecialChar(password.value)">
                                        <mat-icon class="text-xs mr-1">{{ hasSpecialChar(password.value) ? 'check_circle' : 'cancel' }}</mat-icon>
                                        <span class="text-xs">One special character (&#64;$!%*?&)</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="mb-1 block text-xs font-medium text-gray-700">Confirm Password</label>
                            <div class="relative">
                                <input [type]="showPassword ? 'text' : 'password'" class="w-full rounded-md border px-2 py-1.5 pr-6 text-xs shadow-sm focus:border-fidelity-primary focus:ring-fidelity-primary" [class.border-red-300]="registerForm.errors?.['passwordMismatch'] && confirmPassword?.touched" formControlName="confirmPassword" placeholder="Confirm your password" required/>
                                <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-2 text-gray-400 hover:text-gray-600" (click)="togglePasswordVisibility()">
                                    <mat-icon class="text-xs">{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                                </button>
                            </div>
                            <p class="mt-1 text-xs text-red-600" *ngIf="registerForm.errors?.['passwordMismatch'] && confirmPassword?.touched">Passwords do not match</p>
                        </div>
                        <div class="mb-2 flex items-start">
                            <mat-checkbox formControlName="agreementAccepted" id="register-agreement" class="flex-shrink-0 mt-0.5 scale-75 sm:scale-100"></mat-checkbox>
                            <label for="register-agreement" class="ml-1 sm:ml-2 text-xs text-gray-600 leading-relaxed">I agree to the <a href="#" class="font-medium text-fidelity-primary hover:underline" (click)="showTermsModal = true; $event.preventDefault()">Terms of Service</a> and <a href="#" class="font-medium text-fidelity-primary hover:underline" (click)="showDataPrivacyModal = true; $event.preventDefault()">Data Privacy Policy</a>.</label>
                        </div>
                        <button type="button" (click)="register()" class="mt-2 sm:mt-3 w-full rounded-md py-2 text-xs sm:text-sm font-semibold transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2" [ngClass]="{ 'bg-fidelity-primary text-white hover:bg-fidelity-secondary focus:ring-fidelity-primary': registerForm.valid, 'cursor-not-allowed bg-gray-200 text-gray-500': registerForm.invalid || registerForm.disabled }" [disabled]="registerForm.invalid || registerForm.disabled">
                            <ng-container *ngIf="!registerForm.disabled; else registering">Create Account</ng-container>
                            <ng-template #registering>
                                <div class="flex items-center justify-center">
                                    <mat-progress-spinner [diameter]="16" mode="indeterminate" class="mr-2"></mat-progress-spinner>
                                    <span>Creating account...</span>
                                </div>
                            </ng-template>
                        </button>
                    </form>
                    <div class="mt-2 sm:mt-3 text-center text-xs">
                        <span class="text-gray-600">Already have an account?</span>
                        <a class="ml-1 cursor-pointer font-medium text-fidelity-primary hover:underline" (click)="formType = 'login'">Sign In</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>